# 业务场景
提交订单后在售商品数-1，并显示30分钟内没有支付就取消订单。退出支付界面后再进入支付界面，显示剩余时间。自动取消订单后在售商品数量+1

# 遇到的问题
- 取消的订单需入库，方便后期数据分析
- 商品出仓和回仓问题
- 支付成功后需删除30分钟内没支付就取消订单的任务

# 业务说明
- 被动超时：订单写入redis中，设置过期时间为30分，这样无法解决商品回库问题，除非在售商品数实时计算。
- 主动轮询：实现一个延时消息队列

# 架构图

# 使用方式
## 初始化数据、启动服务
```sh
php start.php
```
## 提交订单
```sh
php submit.php
```



[延迟队列][1]
[有赞延迟队列设计][2]
[1分钟实现“延迟消息”功能][3]


  [1]: https://github.com/ouqiang/delay-queue
  [2]: http://tech.youzan.com/queuing_delay
  [3]: https://mp.weixin.qq.com/s/eDMV25YqCPYjxQG-dvqSqQ